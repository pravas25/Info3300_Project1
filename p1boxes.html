<html>
	<head>
        <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="main.css">
		<!-- Load the d3 library. -->
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>

	</head>

		<header>
		<h1> Pizza Stores<br>VS </br>Depression in the United States </h1> <!-- ADDED STUFF HERE -->
		<svg height = "160" width = "400" id="key"> 
				<rect x = "0" y = "10" width = "30" height = "20" rx = "5" ry = "5" fill = "#022835"> </rect>
				<text x = "35" y = "25" fill = "black" font-family = "lato"> = 13.2 - 14.8 </text>
				<rect x = "0" y = "40" width = "30" height = "20" rx = "5" ry = "5" fill = "#104050"> </rect>
				<text x = "35" y = "55" fill = "black" font-family = "lato"> = 11.1 - 13.1 </text>
				<rect x = "0" y = "70" width = "30" height = "20" rx = "5" ry = "5" fill = "#26596A"> </rect>
				<text x = "35" y = "85" fill = "black" font-family = "lato"> = 9.0 - 11.0 </text>
				<rect x = "0" y = "100" width = "30" height = "20" rx = "5" ry = "5" fill = "#457585"> </rect>
				<text x = "35" y = "115" fill = "black" font-family = "lato"> = 6.9 - 8.9 </text>
				<rect x = "0" y = "130" width = "30" height = "20" rx = "5" ry = "5" fill = "#6C939F"> </rect>
				<text x = "35" y = "145" fill = "black" font-family = "lato"> = 4.8 - 6.8 </text>
		</svg>
	</header>

	<body>
	<!-- The SVG element will go in here -->
	<div id="map">
        </div>
	
	<script>
        //constants
		var MAINWIDTH = 960,
			MAINHEIGHT = 2500;
        var WIDTH = 180,
            HEIGHT = 120;
        var COLPADDING = 10,
            ROWPADDING = 20;
        var ROW = 5;
        
        var svgContainer;
        var svgRectangles;
        var rectangles;
        
        var pizzaRange1;
        var pizza = [];
		 
        //read depression and pizzastore data
		var data = d3.csv("depressionData.csv", function(rows){
            
            //generate outer SVG
			svgContainer = d3.select("body").append("svg")
                             .attr("width", MAINWIDTH)
                             .attr("height", MAINHEIGHT);
            
            //generate SVG per state
            svgRectangles = svgContainer.selectAll("svg").data(rows).enter().append("svg")
                            .attr("width", WIDTH)
                            .attr("height", HEIGHT)
                            .attr("x", function (d){ 
                            //generate x coordinate for SVG
                                    if(d.id%ROW != 0) return ((d.id - 1)%ROW)*WIDTH + ((d.id)%ROW)*COLPADDING; 
                                    else return ((d.id - 1)%ROW)*WIDTH + ROW*COLPADDING; })
                                                .attr("y", function (d) { 
                                                //generate Y coordinate for SVG
                                    if((parseInt(d.id%ROW)) != 0)
                                        return (parseInt(d.id/ROW))*HEIGHT +((parseInt(d.id/ROW))+1)*ROWPADDING; 
                                    else
                                        return (parseInt((d.id-1)/ROW))*HEIGHT +((parseInt((d.id-1)/ROW))+1)*ROWPADDING; })
                            .attr("id", function(d, i) { return ( "svg_" + i) });
            
            //generate rectangles
            rectangles = svgRectangles.append("rect");

			var rectangleAttributes = rectangles
                            .attr("rx", 20)
                            .attr("ry", 20)
                            .attr("height", HEIGHT)
                            .attr("width", WIDTH)
                            .style("fill", function(d) { 
                                    if (d.AnyCurrentDepression>=13.2 && d.AnyCurrentDepression <=14.8)
                                        return "#0B1B1E";
                                    else if (d.AnyCurrentDepression>=11.1 && d.AnyCurrentDepression <=13.1)
                                        return "#073945";
                                    else if (d.AnyCurrentDepression>=9 && d.AnyCurrentDepression <=11)
                                        return "#2C6674";
                                    else if (d.AnyCurrentDepression>=6.9 && d.AnyCurrentDepression <=8.9)
                                        return "#6D9DA8";
                                    else if (d.AnyCurrentDepression>=4.8 && d.AnyCurrentDepression <=6.8)
                                        return "#A3A8A9";
                                    else
                                        return "black";
                                        })
                            .attr("id", function(d){ return d.id });
            
            //generate text
            var text = svgContainer.selectAll("svg").append("text");
			var textLabels = text
							.attr("x", function(d) {return 90;})
							.attr("y", function(d) {return 25;})
							.attr("font-family", "lato")
							.attr("font-size", "20px")
							.attr("text-anchor", "middle")
							.attr("fill", "white")
							.text(function(d) { return d.State; });

            //generate pizza shape
            var pizzaPath = [ {"x": 35, "y": 40}, {"x": 50, "y": 70},
                             {"x": 65, "y": 40}, {"x": 50, "y": 35},
                             {"x": 35, "y": 40}];
            //generate pepperoni locations
            var pepperoniData = [
                { "cx": 45, "cy": 45, "radius": 4, "color": "red" },
                { "cx": 55, "cy": 55, "radius": 4, "color": "red" } ];

            var lineFunction = d3.svg.line()
            .x(function(d) { return d.x; })
            .y(function(d) { return d.y; })
            .interpolate("monotone");
            
            //Establish range of pizza stores for each state and set as class
            var stateClass = svgRectangles.attr("class", function(d) {                
                if (d.StoresPerPeople <= 1.80 ) return "range1";
                if (d.StoresPerPeople <= 2.05 ) return "range2";
                if (d.StoresPerPeople <= 2.30 ) return "range3";
                if (d.StoresPerPeople <= 2.50 ) return "range4";
                if (d.StoresPerPeople <= 3.20 ) return "range5";
                if (d.StoresPerPeople <= 3.90 ) return "range6";
            });
            
            //ONE PIZZA
            //create group for one pizza
            var stateRange1 = svgContainer.selectAll(".range1").append("g");
            //make first pizza
            var pizza1 = stateRange1.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
            //give pizza pepperoni toppings
            var pizzaTopping1 = stateRange1.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            var toppingAttributes1 = pizzaTopping1
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //TWO PIZZAS
            var stateRange2 = svgContainer.selectAll(".range2").append("g").attr("id", "pizzaFirst");
            var pizza2 = stateRange2.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
                
            var pizzaTopping2 = stateRange2.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            //2nd pizza
            svgContainer.selectAll(".range2").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,0)");
            
            var toppingAttributes2 = pizzaTopping2
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //THREE PIZZAS

            var stateRange3 = svgContainer.selectAll(".range3").append("g").attr("id", "pizzaFirst");
            var pizza3 = stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
                
            var pizzaTopping3 = stateRange3.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            svgContainer.selectAll(".range3").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,0)");            
            svgContainer.selectAll(".range3").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(80,0)");
            
            var toppingAttributes3 = pizzaTopping3
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //FOUR PIZZAS
            var stateRange4 = svgContainer.selectAll(".range4").append("g").attr("id", "pizzaFirst");
            var pizza4 = stateRange4.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
                
            var pizzaTopping4 = stateRange4.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            svgContainer.selectAll(".range4").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,0)");            
            svgContainer.selectAll(".range4").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(80,0)");
            //5th pizza
            svgContainer.selectAll(".range4").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(0,40)");
            
            var toppingAttributes4 = pizzaTopping4
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //FIVE PIZZAS
            var stateRange5 = svgContainer.selectAll(".range5").append("g").attr("id", "pizzaFirst");
            var pizza5 = stateRange5.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
                
            var pizzaTopping5 = stateRange5.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            svgContainer.selectAll(".range5").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,0)");            
            svgContainer.selectAll(".range5").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(80,0)");
            svgContainer.selectAll(".range5").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(0,40)");
            svgContainer.selectAll(".range5").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,40)");
            
            var toppingAttributes5 = pizzaTopping5
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //SIX PIZZAS
            var stateRange6 = svgContainer.selectAll(".range6").append("g").attr("id", "pizzaFirst");
            var pizza6 = stateRange6.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "#ffbd19");
                
            var pizzaTopping6 = stateRange6.selectAll("circle")
                .data(pepperoniData)
                .enter()
                .append("circle");
            
            svgContainer.selectAll(".range6").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,0)");            
            svgContainer.selectAll(".range6").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(80,0)");
            svgContainer.selectAll(".range6").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(0,40)");
            svgContainer.selectAll(".range6").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(40,40)");
            svgContainer.selectAll(".range6").append("use")
                .attr("xlink:href","#pizzaFirst")
                .attr("transform", "translate(80,40)");
            
            var toppingAttributes6 = pizzaTopping6
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });

		}); //end d3.csv depression

	</script>

	</body>
</html>