<html>
	<head>
        <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
		<!-- Load the d3 library. -->
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>

	</head>
	<body>
	<!-- The SVG element will go in here -->
	<div id="map"></div>
	
	<script>
		var width = 1420,
			height = 2500;
        
        var STATEWIDTH = 180;
        var STATEHEIGHT = 120;
        var svgContainer;
        var svgRectangles;
        var rectangles;
        
        var pizzaRange1;
        var pizza = [];
		 
        //read depression data
		var data = d3.csv("depressionData.csv", function(rows){
            
            //generate outer SVG
			svgContainer = d3.select("body").append("svg")
								 .attr("width", width)
								 .attr("height", height);
            
            //generate SVG per state
            svgRectangles = svgContainer.selectAll("svg")
                                    .data(rows).enter()
                                    .append("svg")
            .attr("width", STATEWIDTH)
                                    .attr("height", STATEHEIGHT)

            .attr("x", function (d){ 
                //generate x coordinate for SVG
                                if(d.id%5 != 0)
                                    return ((d.id - 1)%5)*180 + ((d.id)%5)*20; 
                                else 
                                    return ((d.id - 1)%5)*180 + 5*20; })
										.attr("y", function (d) { 
                                            //generate Y coordinate for SVG
                    if((parseInt(d.id%)) != 0)
                        return (parseInt(d.id/9))*120 +((parseInt(d.id/9))+1)*30; 
                    else
                        return (parseInt((d.id-1)/9))*120 +((parseInt((d.id-1)/9))+1)*30; 
														})
            .attr("id", function(d, i) { return ( "svg_" + i) });
            
            //generate rectangles
            rectangles = svgRectangles.append("rect");

			var rectangleAttributes = rectangles
										.attr("rx", 20)
										.attr("ry", 20)
										
										.attr("height", STATEHEIGHT)
										.attr("width", STATEWIDTH)
										.style("fill", function(d) { 
														if (d.AnyCurrentDepression>=13.2 && d.AnyCurrentDepression <=14.8)
															return "#022835";
														else if (d.AnyCurrentDepression>=11.1 && d.AnyCurrentDepression <=13.1)
															return "#104050";
														else if (d.AnyCurrentDepression>=9 && d.AnyCurrentDepression <=11)
															return "#26596A";
														else if (d.AnyCurrentDepression>=6.9 && d.AnyCurrentDepression <=8.9)
															return "#457585";
														else if (d.AnyCurrentDepression>=4.8 && d.AnyCurrentDepression <=6.8)
															return "#6C939F";
														else
															return "black";
															})
										.attr("id", function(d){ return d.id });
            
            var text = svgContainer.selectAll("svg").append("text");
			var textLabels = text
							.attr("x", function(d) {return 90;})
							.attr("y", function(d) {return 25;})
							.attr("font-family", "lato")
							.attr("font-size", "20px")
							.attr("text-anchor", "middle")
							.attr("fill", "white")
							.text(function(d) { return d.State; });


            var pizzaPath = [ {"x": 10, "y": 25}, {"x": 30, "y": 65},
                             {"x": 50, "y": 25}, {"x": 30, "y": 20},
                             {"x": 10, "y": 25}];

            var lineFunction = d3.svg.line()
            .x(function(d) { return d.x; })
            .y(function(d) { return d.y; })
            .interpolate("monotone");
            
            //Establish range of pizza stores for each state
            var stateClass = svgRectangles.attr("class", function(d) {
                
                if (d.StoresPerPeople <= 1.80 ) return "range1";
                if (d.StoresPerPeople <= 2.05 ) return "range2";
                if (d.StoresPerPeople <= 2.30 ) return "range3";
                if (d.StoresPerPeople <= 2.50 ) return "range4";
                if (d.StoresPerPeople <= 3.20 ) return "range5";
                if (d.StoresPerPeople <= 3.90 ) return "range6";
            });
            
            var PIZZATRANSLATE = 20;
            //ONE PIZZA
            var stateRange1 = svgContainer.selectAll(".range1").append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            
            //TWO PIZZAS
            var stateRange2 = svgContainer.selectAll(".range2");
            stateRange2.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            stateRange2.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate( 40,0)");
            
            //THREE PIZZAS
            var stateRange3 = svgContainer.selectAll(".range3");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate(40,0)");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate(80,0)");

		}); //end d3.csv depression

	</script>

	</body>
</html>