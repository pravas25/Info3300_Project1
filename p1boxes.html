<html>
	<head>
        <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
		<!-- Load the d3 library. -->
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
		<style>
		svg {margin-left:auto; margin-right: auto; display:block;} /*ADDED STUFF HERE*/
		svg { border: solid black 1px; } /*ADDED STUFF HERE*/
		</style>
	</head>

		<header>
		<h1 align = "center"> Pizza Stores per Capita VS Depression in the US </h1> <!-- ADDED STUFF HERE -->
		<svg height = "160" width = "400"> 
				<rect x = "0" y = "10" width = "30" height = "20" rx = "5" ry = "5" fill = "#022835"> </rect>
				<text x = "35" y = "25" fill = "black" font-family = "lato"> = 13.2 - 14.8 </text>
				<rect x = "0" y = "40" width = "30" height = "20" rx = "5" ry = "5" fill = "#104050"> </rect>
				<text x = "35" y = "55" fill = "black" font-family = "lato"> = 11.1 - 13.1 </text>
				<rect x = "0" y = "70" width = "30" height = "20" rx = "5" ry = "5" fill = "#26596A"> </rect>
				<text x = "35" y = "85" fill = "black" font-family = "lato"> = 9.0 - 11.0 </text>
				<rect x = "0" y = "100" width = "30" height = "20" rx = "5" ry = "5" fill = "#457585"> </rect>
				<text x = "35" y = "115" fill = "black" font-family = "lato"> = 6.9 - 8.9 </text>
				<rect x = "0" y = "130" width = "30" height = "20" rx = "5" ry = "5" fill = "#6C939F"> </rect>
				<text x = "35" y = "145" fill = "black" font-family = "lato"> = 4.8 - 6.8 </text>
		</svg>
	</header>

	<body>
	<!-- The SVG element will go in here -->
	<div id="map"></div>
	
	<script>
        //constants
		var MAINWIDTH = 1420,
			MAINHEIGHT = 2500;
        var WIDTH = 180;
        var HEIGHT = 120;
        var COLPADDING = 20;
        var ROWPADDING = 30;
        var ROW = 5;
        
        var svgContainer;
        var svgRectangles;
        var rectangles;
        
        var pizzaRange1;
        var pizza = [];
		 
        //read depression data
		var data = d3.csv("depressionData.csv", function(rows){
            
            //generate outer SVG
			svgContainer = d3.select("body").append("svg")
								 .attr("width", MAINWIDTH)
								 .attr("height", MAINHEIGHT);
            
            //generate SVG per state
            svgRectangles = svgContainer.selectAll("svg")
                                    .data(rows).enter()
                                    .append("svg")
            .attr("width", WIDTH)
                                    .attr("height", HEIGHT)

            .attr("x", function (d){ 
                //generate x coordinate for SVG

                                if(d.id%ROW != 0)
                                    return ((d.id - 1)%ROW)*WIDTH + ((d.id)%ROW)*COLPADDING; 
                                else 
                                    return ((d.id - 1)%ROW)*WIDTH + ROW*COLPADDING; })
										.attr("y", function (d) { 
                                            //generate Y coordinate for SVG
                    if((parseInt(d.id%ROW)) != 0)
                        return (parseInt(d.id/ROW))*HEIGHT +((parseInt(d.id/ROW))+1)*ROWPADDING; 
                    else
                        return (parseInt((d.id-1)/ROW))*HEIGHT +((parseInt((d.id-1)/ROW))+1)*ROWPADDING; 

                              
														})
            .attr("id", function(d, i) { return ( "svg_" + i) });
            
            //generate rectangles
            rectangles = svgRectangles.append("rect");

			var rectangleAttributes = rectangles
										.attr("rx", 20)
										.attr("ry", 20)
										
										.attr("height", HEIGHT)
										.attr("width", WIDTH)
										.style("fill", function(d) { 
														if (d.AnyCurrentDepression>=13.2 && d.AnyCurrentDepression <=14.8)
															return "#022835";
														else if (d.AnyCurrentDepression>=11.1 && d.AnyCurrentDepression <=13.1)
															return "#104050";
														else if (d.AnyCurrentDepression>=9 && d.AnyCurrentDepression <=11)
															return "#26596A";
														else if (d.AnyCurrentDepression>=6.9 && d.AnyCurrentDepression <=8.9)
															return "#457585";
														else if (d.AnyCurrentDepression>=4.8 && d.AnyCurrentDepression <=6.8)
															return "#6C939F";
														else
															return "black";
															})
										.attr("id", function(d){ return d.id });
            
            var text = svgContainer.selectAll("svg").append("text");
			var textLabels = text
							.attr("x", function(d) {return 90;})
							.attr("y", function(d) {return 25;})
							.attr("font-family", "lato")
							.attr("font-size", "20px")
							.attr("text-anchor", "middle")
							.attr("fill", "white")
							.text(function(d) { return d.State; });


            var pizzaPath = [ {"x": 10, "y": 25}, {"x": 30, "y": 65},
                             {"x": 50, "y": 25}, {"x": 30, "y": 20},
                             {"x": 10, "y": 25}];
            
            var pepperoniData = [
                { "cx": 20, "cy": 20, "radius": 5, "color": "red" },
                { "cx": 25, "cy": 30, "radius": 5, "color": "red" } ];

            var lineFunction = d3.svg.line()
            .x(function(d) { return d.x; })
            .y(function(d) { return d.y; })
            .interpolate("monotone");
            
            //Establish range of pizza stores for each state
            var stateClass = svgRectangles.attr("class", function(d) {
                
                if (d.StoresPerPeople <= 1.80 ) return "range1";
                if (d.StoresPerPeople <= 2.05 ) return "range2";
                if (d.StoresPerPeople <= 2.30 ) return "range3";
                if (d.StoresPerPeople <= 2.50 ) return "range4";
                if (d.StoresPerPeople <= 3.20 ) return "range5";
                if (d.StoresPerPeople <= 3.90 ) return "range6";
            });
            
            var PIZZATRANSLATE = 20;
            //ONE PIZZA
            var stateRange1 = svgContainer.selectAll(".range1").append("g");
            var pizza1 = stateRange1.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            var pizzaTopping1 = stateRange1.selectAll("circle")
            .data(pepperoniData)
            .enter()
            .append("circle");
            
            var toppingAttributes1 = pizzaTopping1
                .attr("cx", function (d) { return d.cx; })
                .attr("cy", function (d) { return d.cy; })
                .attr("r", function (d) { return d.radius; })
                .style("fill", function (d) { return d.color; });
            
            //TWO PIZZAS
            var stateRange2 = svgContainer.selectAll(".range2");
            stateRange2.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            stateRange2.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate( 40,0)");
            
            //THREE PIZZAS
            var stateRange3 = svgContainer.selectAll(".range3");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate(40,0)");
            stateRange3.append("path").attr("d", lineFunction(pizzaPath))
                .attr("fill", "orange")
                .attr("transform", "translate(80,0)");

		}); //end d3.csv depression

	</script>

	</body>
</html>